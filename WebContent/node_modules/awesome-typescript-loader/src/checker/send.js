"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const isWindows = /^win/.test(process.platform);
const logOnError = error => { if (error) {
    console.error(error);
} };
function createQueuedSender(childProcess) {
    if (isWindows) {
        let msgQueue = [];
        let isSending = false;
        const cb = error => {
            logOnError(error);
            if (msgQueue.length > 0) {
                setImmediate(doSendLoop);
            }
            else {
                isSending = false;
            }
        };
        const doSendLoop = function () {
            childProcess.send(msgQueue.shift(), cb);
        };
        const send = function (msg) {
            msgQueue.push(msg);
            if (isSending) {
                return;
            }
            isSending = true;
            doSendLoop();
        };
        return { send };
    }
    else {
        const send = function (msg) {
            childProcess.send(msg, logOnError);
        };
        return { send };
    }
}
exports.createQueuedSender = createQueuedSender;
//# sourceMappingURL=send.js.map